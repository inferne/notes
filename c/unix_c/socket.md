# 第16章 网络IPC：套接字

## 16.2 套接字描述符

```c
#include <sys/socket.h>
int socket(int domain, int type, int protocol);
```
### 参数
* domain（域）确定通信的特性，包括地址格式，各个域有自己的格式表示地址，而表示各个域的场数都以AF_开头，意指地址族
  * AF_INET-------------------------IPv4因特网域
  * AF_INET6------------------------IPv6因特网域
  * AF_UNIX/AF_LOCAL----------------UNIX域
  * AF_UNSPEC-----------------------未指定
* type确定套接字的类型，进一步确定通信特征，在实现中可以自由增加对其它类型的支持
  * SOCK_DGRAM----------------------长度固定的、无连接的不可靠报文传递
  * SOCK_RAW------------------------IP协议的数据报接口（POSIX.1中为可选）
  * SOCK_SEQPACKET------------------长度固定，有序、可靠的面向连接报文传递
  * SOCK_STREAM---------------------有序、可靠、双向的面向连接字节流
* protocol通常是0，表示给定的域和套接字类型选择默认协议，当对同一域和套接字类型支持多个协议时，可以使用protocol选择一个特定协议。在AF_INET通信域中套接字类型SOCK_STREAM的默认协议是TCP（传输控制协议），套接字类型SOCK_DGRAM的默认协议是UDP（用户数据报协议）。

数据报是一种自包含报文

对于SOCK_STREAM套接字，应用程序意识不到报文界限，因为套接字提供的是字节流服务。这意味着当从套接字读取数据时，他也许不会返回所有由发送进程所写的字节数。最终可以获得发送过来的所有数据，但也许要通过若干次函数调用得到。

SOCK_SEQPACKET套接字和SOCK_STREAM套接字很类似，但从该套接字得到的是基于报文的服务而不是字节流服务。这意味这从SOCK_SEQPACKET套接字接收的数据量与对方所发送的一致。流控制传输协议（Stream Control Transmission Protocol，SCTP）提供了因特网域上的顺序数据包服务。

SOCK_RAW套接字提供一个数据报接口用于直接访问下面的网络层（在因特网域中为IP）。使用这个接口时，应用程序负责构造自己的协议首部，这是因为传输协议（TCP和UDP等）被绕过了。当创建一个原始套接字时需要有超级用户权限，用以防止恶意程序绕过内建安全机制来创建报文。
